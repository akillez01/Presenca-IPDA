# ğŸ“‹ Sistema de PresenÃ§a IPDA

<div align="center">
  <img src="public/images/logodeuseamor.png" alt="Igreja Pentecostal Deus Ã© Amor" width="120" height="120">
  
  **Sistema Moderno de Controle de PresenÃ§a para Igreja Pentecostal Deus Ã© Amor**
  
  [![Next.js](https://img.shields.io/badge/Next.js-15.3.3-black?style=flat-square&logo=next.js)](https://nextjs.org/)
  [![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue?style=flat-square&logo=typescript)](https://www.typescriptlang.org/)
  [![Firebase](https://img.shields.io/badge/Firebase-11.9.1-orange?style=flat-square&logo=firebase)](https://firebase.google.com/)
  [![Tailwind CSS](https://img.shields.io/badge/Tailwind-3.4.1-38B2AC?style=flat-square&logo=tailwind-css)](https://tailwindcss.com/)
  [![React](https://img.shields.io/badge/React-18.3.1-61DAFB?style=flat-square&logo=react)](https://reactjs.org/)
  
  **ğŸ‘¨â€ğŸ’» Desenvolvido por AchillesOS**
</div>

---

## ğŸ¯ **VisÃ£o Geral**

O Sistema de PresenÃ§a IPDA Ã© uma aplicaÃ§Ã£o web moderna e responsiva desenvolvida especificamente para o controle e gerenciamento de presenÃ§a dos membros da Igreja Pentecostal Deus Ã© Amor. O sistema oferece recursos avanÃ§ados de analytics, controle de usuÃ¡rios e configuraÃ§Ãµes dinÃ¢micas, tudo em tempo real.

### âœ¨ **Principais CaracterÃ­sticas**

- ğŸ“Š **Dashboard Interativo** com analytics em tempo real e mÃ©tricas detalhadas
- ğŸ‘¥ **Gerenciamento Completo de UsuÃ¡rios** com controle de permissÃµes multi-nÃ­vel
- ğŸ”§ **ConfiguraÃ§Ãµes DinÃ¢micas** de cargos, turnos e opÃ§Ãµes do sistema
- ğŸ“± **100% Responsivo** - interface otimizada para mobile, tablet e desktop
- ğŸ”’ **Sistema de SeguranÃ§a Robusto** com diferentes nÃ­veis de acesso (Super/Admin/Normal)
- ğŸ“ˆ **RelatÃ³rios AvanÃ§ados** com grÃ¡ficos interativos e estatÃ­sticas detalhadas
- âš¡ **Performance Otimizada** com Next.js 15+ e carregamento ultrarrÃ¡pido
- ğŸ”„ **AtualizaÃ§Ãµes em Tempo Real** via Firebase Realtime Database
- ğŸ¨ **Interface Moderna** com Shadcn/ui e animaÃ§Ãµes suaves
- ğŸ’¾ **Backup AutomÃ¡tico** de dados e configuraÃ§Ãµes

---

## ğŸš€ **Tecnologias Utilizadas**

### **Frontend**

- **Next.js 15.3.3** - Framework React com App Router, SSR e SSG
- **TypeScript 5.0** - Tipagem estÃ¡tica para maior seguranÃ§a e produtividade
- **React 18.3.1** - Biblioteca JavaScript para interfaces de usuÃ¡rio
- **Tailwind CSS 3.4.1** - Framework CSS utility-first para estilizaÃ§Ã£o rÃ¡pida
- **Shadcn/ui** - Sistema de componentes moderno e acessÃ­vel
- **Lucide React** - Ãcones SVG otimizados e consistentes
- **Radix UI** - Componentes headless com acessibilidade nativa

### **Backend & Database**

- **Firebase 11.9.1** - Plataforma completa para desenvolvimento
- **Firestore** - Banco de dados NoSQL em tempo real
- **Firebase Authentication** - Sistema de autenticaÃ§Ã£o seguro e escalÃ¡vel
- **Firebase Hosting** - Deploy e hospedagem com CDN global
- **Firebase Security Rules** - Controle de acesso granular e robusto

### **Ferramentas de Desenvolvimento**

- **React Hook Form 7.54.2** - Gerenciamento eficiente de formulÃ¡rios
- **Zod 3.24.2** - ValidaÃ§Ã£o de schemas com TypeScript
- **Date-fns 3.6.0** - ManipulaÃ§Ã£o moderna de datas
- **Recharts 2.15.1** - GrÃ¡ficos e visualizaÃ§Ãµes interativas
- **Class Variance Authority** - Gerenciamento de variantes CSS
- **Clsx** - UtilitÃ¡rio para concatenaÃ§Ã£o condicional de classes

### **AI & Analytics**

- **Google AI Genkit 1.13.0** - IntegraÃ§Ã£o com IA para insights avanÃ§ados
- **Analytics Personalizados** - MÃ©tricas customizadas para a igreja

---

## ğŸ“‹ **Funcionalidades Detalhadas**

### ğŸ  **Dashboard Principal**

- **ğŸ“Š VisÃ£o Geral em Tempo Real**: PresenÃ§as do dia com atualizaÃ§Ã£o automÃ¡tica
- **ğŸ“ˆ GrÃ¡ficos Interativos**: EstatÃ­sticas por perÃ­odo, cargo e regiÃ£o
- **ğŸ” Resumo de Atividades**: HistÃ³rico recente de registros e alteraÃ§Ãµes
- **âš¡ Indicadores de Performance**: MÃ©tricas de participaÃ§Ã£o e engajamento
- **ğŸ“± Widget de NotificaÃ§Ãµes**: Alertas e lembretes importantes

### ğŸ‘¤ **Sistema de UsuÃ¡rios Multi-NÃ­vel**

- **ğŸ”‘ Super UsuÃ¡rios**: Acesso administrativo completo ao sistema
  - Gerenciamento total de usuÃ¡rios e permissÃµes
  - ConfiguraÃ§Ã£o global do sistema
  - Acesso a dados sensÃ­veis e relatÃ³rios administrativos
- **âš™ï¸ UsuÃ¡rios Administradores**: Acesso limitado Ã s funÃ§Ãµes administrativas
  - Gerenciamento de usuÃ¡rios comuns
  - ConfiguraÃ§Ã£o de opÃ§Ãµes bÃ¡sicas
- **ğŸ‘¥ UsuÃ¡rios Normais**: Acesso Ã s funcionalidades essenciais
  - Registro de presenÃ§a
  - VisualizaÃ§Ã£o de relatÃ³rios pessoais
- **ğŸ›¡ï¸ ProteÃ§Ã£o de Rotas**: Sistema avanÃ§ado de guards e validaÃ§Ãµes

### ğŸ“ **Registro de PresenÃ§a Inteligente**

- **ğŸ“± FormulÃ¡rio Responsivo**: Interface otimizada para qualquer dispositivo
- **ğŸ”§ Campos DinÃ¢micos**: ConfiguraÃ§Ã£o flexÃ­vel de campos e opÃ§Ãµes
- **âœ… ValidaÃ§Ã£o em Tempo Real**: Feedback instantÃ¢neo durante o preenchimento
- **ğŸ“Š MÃºltiplos Status**: Presente, Ausente, Justificado com detalhamento
- **ğŸ’¾ Auto-save**: Salvamento automÃ¡tico para evitar perda de dados
- **ğŸ” Busca Inteligente**: LocalizaÃ§Ã£o rÃ¡pida de membros por nome ou CPF

### ğŸ“Š **RelatÃ³rios e Analytics AvanÃ§ados**

- **ğŸ“ˆ Dashboard de EstatÃ­sticas**: MÃ©tricas em tempo real com grÃ¡ficos interativos
- **ğŸ“… AnÃ¡lise Temporal**: RelatÃ³rios por dia, semana, mÃªs e perÃ­odo customizado
- **ğŸ‘¥ SegmentaÃ§Ã£o AvanÃ§ada**: AnÃ¡lise por cargo, regiÃ£o e classificaÃ§Ã£o
- **ğŸ“‰ TendÃªncias e PadrÃµes**: IdentificaÃ§Ã£o de comportamentos e sazonalidades
- **ğŸ“‹ RelatÃ³rios Personalizados**: GeraÃ§Ã£o de relatÃ³rios sob medida
- **ğŸ’¾ ExportaÃ§Ã£o FlexÃ­vel**: Download em mÃºltiplos formatos (PDF, Excel, CSV)
- **ğŸ”” Alertas AutomÃ¡ticos**: NotificaÃ§Ãµes baseadas em mÃ©tricas prÃ©-definidas

### âš™ï¸ **ConfiguraÃ§Ãµes DinÃ¢micas e PersonalizaÃ§Ã£o**

- **ğŸ›ï¸ Gerenciamento de Cargos**: AdiÃ§Ã£o/remoÃ§Ã£o dinÃ¢mica de posiÃ§Ãµes da igreja
- **ğŸŒ Controle de RegiÃµes**: ConfiguraÃ§Ã£o flexÃ­vel de Ã¡reas geogrÃ¡ficas
- **â° GestÃ£o de Turnos**: PersonalizaÃ§Ã£o de horÃ¡rios e perÃ­odos
- **ğŸ›ï¸ OpÃ§Ãµes do Sistema**: ConfiguraÃ§Ã£o de comportamentos e preferÃªncias
- **ğŸ’¾ Backup e Restore**: Sistema de backup automÃ¡tico e manual
- **ğŸ”„ SincronizaÃ§Ã£o**: AtualizaÃ§Ã£o em tempo real em todos os dispositivos
- **ğŸ¨ PersonalizaÃ§Ã£o Visual**: Temas e cores customizÃ¡veis

### ğŸ”’ **SeguranÃ§a e Auditoria**

- **ğŸ›¡ï¸ AutenticaÃ§Ã£o Robusta**: Sistema Firebase com mÃºltiplos fatores
- **ğŸ“ Log de Auditoria**: Rastreamento completo de aÃ§Ãµes do sistema
- **ğŸ” Controle de SessÃ£o**: Gerenciamento seguro de sessÃµes ativas
- **âš ï¸ Monitoramento**: DetecÃ§Ã£o de atividades suspeitas
- **ğŸ”’ Criptografia**: ProteÃ§Ã£o de dados sensÃ­veis
- **ğŸš« Rate Limiting**: ProteÃ§Ã£o contra ataques e uso abusivo

---

## ğŸ”§ **InstalaÃ§Ã£o e ConfiguraÃ§Ã£o**

### **PrÃ©-requisitos**

- **Node.js 18+** - Runtime JavaScript
- **npm** ou **yarn** - Gerenciador de pacotes
- **Conta Firebase** - Backend e autenticaÃ§Ã£o
- **Git** - Controle de versÃ£o

### **1. Clone o RepositÃ³rio**

```bash
git clone https://github.com/AchillesOS/sistema-presenca-ipda.git
cd sistema-presenca-ipda
```

### **2. Instale as DependÃªncias**

```bash
# Usando npm
npm install

# Usando yarn
yarn install
```

### **3. ConfiguraÃ§Ã£o do Firebase**

#### **3.1. Criar Projeto Firebase**

1. Acesse o [Firebase Console](https://console.firebase.google.com/)
2. Clique em "Criar projeto"
3. Configure o projeto com nome: `sistema-presenca-ipda`
4. Ative Google Analytics (opcional)

#### **3.2. Configurar ServiÃ§os**

1. **Authentication**:
   - Ative o provedor "Email/senha"
   - Configure domÃ­nios autorizados
2. **Firestore Database**:
   - Crie banco no modo "produÃ§Ã£o"
   - Configure regras de seguranÃ§a
3. **Hosting** (opcional):
   - Configure para deploy automÃ¡tico

#### **3.3. Obter Credenciais**

1. VÃ¡ em "ConfiguraÃ§Ãµes do projeto"
2. Na aba "Geral", encontre "Seus aplicativos"
3. Clique em "Web" e registre o app
4. Copie as configuraÃ§Ãµes do Firebase

#### **3.4. Configurar VariÃ¡veis de Ambiente**

Crie o arquivo `.env.local` na raiz do projeto:

```env
# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyC...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=sistema-presenca-ipda.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=sistema-presenca-ipda
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=sistema-presenca-ipda.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abc123

# Optional: Analytics
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-XXXXXXXXXX

# Development
NODE_ENV=development
```

### **4. Configurar Firestore Rules**

#### **4.1. Instalar Firebase CLI**

```bash
npm install -g firebase-tools
firebase login
firebase init firestore
```

#### **4.2. Deploy das Regras**

```bash
firebase deploy --only firestore:rules
```

### **5. ConfiguraÃ§Ã£o Inicial do Sistema**

#### **5.1. Criar Super UsuÃ¡rio**

1. Execute o projeto em desenvolvimento
2. Registre o primeiro usuÃ¡rio
3. No Firebase Console, adicione o campo `role: 'super'` ao documento do usuÃ¡rio

#### **5.2. Configurar Dados Iniciais**

```bash
# Executar script de configuraÃ§Ã£o inicial (se disponÃ­vel)
npm run setup:initial-data
```

### **6. Executar o Projeto**

#### **Desenvolvimento**

```bash
npm run dev
# ou
yarn dev
```

Acesse: `http://localhost:9002`

#### **ProduÃ§Ã£o Local**

```bash
npm run build
npm run start
```

#### **Com Turbopack (Mais RÃ¡pido)**

```bash
npm run dev:turbo
```

### **7. ConfiguraÃ§Ãµes AvanÃ§adas**

#### **7.1. Analytics e IA (Opcional)**

```bash
# Configurar Genkit para IA
npm run genkit:dev

# Iniciar em modo watch
npm run genkit:watch
```

#### **7.2. Configurar DomÃ­nio Personalizado**

1. No Firebase Hosting, adicione domÃ­nio customizado
2. Configure DNS para apontar para Firebase
3. SSL serÃ¡ configurado automaticamente

### **8. VerificaÃ§Ã£o da InstalaÃ§Ã£o**

#### **Checklist de VerificaÃ§Ã£o**

- [ ] âœ… PÃ¡gina inicial carrega corretamente
- [ ] ğŸ” Sistema de login funciona
- [ ] ğŸ“Š Dashboard exibe dados
- [ ] ğŸ“ FormulÃ¡rio de presenÃ§a funciona
- [ ] ğŸ‘¥ Gerenciamento de usuÃ¡rios acessÃ­vel (super usuÃ¡rios)
- [ ] âš™ï¸ ConfiguraÃ§Ãµes dinÃ¢micas respondem
- [ ] ğŸ“± Interface responsiva em mobile

#### **SoluÃ§Ã£o de Problemas Comuns**

```bash
# Limpar cache do Next.js
rm -rf .next

# Reinstalar dependÃªncias
rm -rf node_modules package-lock.json
npm install

# Verificar variÃ¡veis de ambiente
npm run env:check

# Verificar conexÃ£o Firebase
npm run firebase:test
```

---

## ğŸ—ï¸ **Estrutura do Projeto**

```
src/
â”œâ”€â”€ app/                    # App Router (Next.js 13+)
â”‚   â”œâ”€â”€ (auth)/            # PÃ¡ginas de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ admin/             # PÃ¡ginas administrativas
â”‚   â”œâ”€â”€ config/            # ConfiguraÃ§Ãµes do sistema
â”‚   â””â”€â”€ reports/           # RelatÃ³rios e analytics
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ ui/               # Componentes base (Shadcn)
â”‚   â”œâ”€â”€ auth/             # Componentes de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ layout/           # Layout e navegaÃ§Ã£o
â”‚   â””â”€â”€ admin/            # Componentes administrativos
â”œâ”€â”€ hooks/                # Custom hooks
â”œâ”€â”€ lib/                  # UtilitÃ¡rios e configuraÃ§Ãµes
â”‚   â”œâ”€â”€ firebase.ts       # ConfiguraÃ§Ã£o Firebase
â”‚   â”œâ”€â”€ auth.ts           # LÃ³gica de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ actions.ts        # Actions do Firestore
â”‚   â””â”€â”€ types.ts          # DefiniÃ§Ãµes de tipos
â””â”€â”€ styles/               # Estilos globais
```

---

## ğŸ” **Sistema de AutenticaÃ§Ã£o e SeguranÃ§a**

### **Hierarquia de UsuÃ¡rios**

#### **ğŸ”¥ Super UsuÃ¡rios (NÃ­vel 3)**

**E-mails Autorizados:**

- `admin@ipda.org.br`
- `marciodesk@ipda.app.br`

**PermissÃµes Completas:**

- âœ… **Gerenciamento Total**: Criar, editar e excluir qualquer usuÃ¡rio
- âœ… **ConfiguraÃ§Ã£o Global**: Modificar todas as configuraÃ§Ãµes do sistema
- âœ… **Dados SensÃ­veis**: Acesso a informaÃ§Ãµes confidenciais e mÃ©tricas avanÃ§adas
- âœ… **Audit Trail**: Visualizar logs completos de auditoria
- âœ… **Backup/Restore**: Gerenciar backups e restauraÃ§Ãµes
- âœ… **Sistema**: Configurar regras de negÃ³cio e validaÃ§Ãµes
- âœ… **Deploy**: Controlar atualizaÃ§Ãµes e manutenÃ§Ãµes

#### **âš™ï¸ Administradores (NÃ­vel 2)**

**PermissÃµes Administrativas:**

- âœ… **UsuÃ¡rios Comuns**: Gerenciar usuÃ¡rios nÃ£o-administrativos
- âœ… **RelatÃ³rios**: Gerar e visualizar relatÃ³rios administrativos
- âœ… **ConfiguraÃ§Ãµes BÃ¡sicas**: Modificar cargos e opÃ§Ãµes bÃ¡sicas
- âœ… **ModeraÃ§Ã£o**: Revisar e aprovar registros pendentes
- âŒ **Super FunÃ§Ãµes**: NÃ£o pode gerenciar outros admins ou super usuÃ¡rios

#### **ğŸ‘¤ UsuÃ¡rios Normais (NÃ­vel 1)**

**PermissÃµes BÃ¡sicas:**

- âœ… **Dashboard Pessoal**: Visualizar mÃ©tricas prÃ³prias
- âœ… **Registro**: Cadastrar presenÃ§as e informaÃ§Ãµes pessoais
- âœ… **RelatÃ³rios Pessoais**: Ver prÃ³prios dados e estatÃ­sticas
- âœ… **Perfil**: Editar informaÃ§Ãµes pessoais bÃ¡sicas
- âŒ **FunÃ§Ãµes Administrativas**: Sem acesso a painÃ©is administrativos

### **ğŸ›¡ï¸ ImplementaÃ§Ãµes de SeguranÃ§a**

```typescript
// VerificaÃ§Ã£o de autenticaÃ§Ã£o
const isAuthenticated = user && user.uid;

// VerificaÃ§Ã£o de nÃ­vel de acesso
const isSuperUser = user?.email && SUPER_USERS.includes(user.email);
const isAdmin = user?.role === "admin" || isSuperUser;

// Guards de proteÃ§Ã£o
<SuperUserGuard>
  <AdminPanel />
</SuperUserGuard>;
```

#### **Regras de Firestore (ProduÃ§Ã£o)**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // FunÃ§Ã£o para verificar super usuÃ¡rios
    function isSuperUser() {
      return request.auth != null &&
             request.auth.token.email in [
               'admin@ipda.org.br',
               'marciodesk@ipda.app.br'
             ];
    }

    // FunÃ§Ã£o para verificar admin
    function isAdmin() {
      return isSuperUser() ||
             (request.auth != null &&
              get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }

    // Attendance: Leitura para todos autenticados, escrita apenas para admins+
    match /attendance/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Users: Apenas super usuÃ¡rios podem gerenciar
    match /users/{document} {
      allow read: if request.auth != null;
      allow write: if isSuperUser();
      allow create: if request.auth != null && request.auth.uid == document;
    }

    // System config: Apenas admins+ podem modificar
    match /system/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
  }
}
```

#### **ValidaÃ§Ãµes Client-Side**

```typescript
// ValidaÃ§Ã£o de dados com Zod
const attendanceSchema = z.object({
  fullName: z.string().min(3, "Nome deve ter pelo menos 3 caracteres"),
  cpf: z.string().regex(/^\d{11}$/, "CPF deve ter 11 dÃ­gitos"),
  status: z.enum(["Presente", "Ausente", "Justificado"]),
  timestamp: z.date(),
});

// SanitizaÃ§Ã£o de inputs
const sanitizeInput = (input: string) => {
  return DOMPurify.sanitize(input.trim());
};
```

#### **ProteÃ§Ãµes Adicionais**

- ğŸ”’ **Rate Limiting**: Controle de requisiÃ§Ãµes por usuÃ¡rio
- ğŸ›¡ï¸ **CORS**: Configurado para domÃ­nios especÃ­ficos
- ğŸ” **Headers de SeguranÃ§a**: X-Frame-Options, CSP, HSTS
- ğŸš« **XSS Protection**: SanitizaÃ§Ã£o de inputs e outputs
- ğŸ“ **Audit Logging**: Log completo de aÃ§Ãµes crÃ­ticas
- âš ï¸ **Anomaly Detection**: DetecÃ§Ã£o de padrÃµes suspeitos

### **ğŸ” Monitoramento e Auditoria**

#### **Logs de Auditoria**

```typescript
// Log automÃ¡tico de aÃ§Ãµes crÃ­ticas
const auditLog = {
  userId: user.uid,
  userEmail: user.email,
  action: "USER_CREATED",
  targetId: newUser.uid,
  timestamp: new Date(),
  details: { role: "admin", region: "SÃ£o Paulo" },
  ipAddress: request.ip,
  userAgent: request.headers["user-agent"],
};
```

#### **Alertas de SeguranÃ§a**

- ğŸš¨ **Login Suspeito**: Tentativas de locais nÃ£o usuais
- âš ï¸ **MÃºltiplas Tentativas**: Bloqueio temporÃ¡rio apÃ³s falhas
- ğŸ“§ **NotificaÃ§Ãµes**: Email para admins em aÃ§Ãµes crÃ­ticas
- ğŸ“Š **Dashboard de SeguranÃ§a**: MÃ©tricas de seguranÃ§a em tempo real

### **ğŸ”’ Melhores PrÃ¡ticas Implementadas**

1. **PrincÃ­pio do Menor PrivilÃ©gio**: UsuÃ¡rios recebem apenas permissÃµes necessÃ¡rias
2. **SeparaÃ§Ã£o de Responsabilidades**: Diferentes nÃ­veis para diferentes funÃ§Ãµes
3. **ValidaÃ§Ã£o Dupla**: Client-side + server-side validation
4. **Criptografia**: Dados sensÃ­veis sempre criptografados
5. **SessÃµes Seguras**: Timeout automÃ¡tico e renovaÃ§Ã£o de tokens
6. **Backup de SeguranÃ§a**: Backups criptografados e versionados

---

## ğŸ”§ **InstalaÃ§Ã£o e ConfiguraÃ§Ã£o**

### **PrÃ©-requisitos**

- **Node.js 18+** - Runtime JavaScript
- **npm** ou **yarn** - Gerenciador de pacotes
- **Conta Firebase** - Backend e autenticaÃ§Ã£o
- **Git** - Controle de versÃ£o

### **1. Clone o RepositÃ³rio**

```bash
git clone https://github.com/AchillesOS/sistema-presenca-ipda.git
cd sistema-presenca-ipda
```

### **2. Instale as DependÃªncias**

```bash
# Usando npm
npm install

# Usando yarn
yarn install
```

### **3. ConfiguraÃ§Ã£o do Firebase**

#### **3.1. Criar Projeto Firebase**

1. Acesse o [Firebase Console](https://console.firebase.google.com/)
2. Clique em "Criar projeto"
3. Configure o projeto com nome: `sistema-presenca-ipda`
4. Ative Google Analytics (opcional)

#### **3.2. Configurar ServiÃ§os**

1. **Authentication**:
   - Ative o provedor "Email/senha"
   - Configure domÃ­nios autorizados
2. **Firestore Database**:
   - Crie banco no modo "produÃ§Ã£o"
   - Configure regras de seguranÃ§a
3. **Hosting** (opcional):
   - Configure para deploy automÃ¡tico

#### **3.3. Obter Credenciais**

1. VÃ¡ em "ConfiguraÃ§Ãµes do projeto"
2. Na aba "Geral", encontre "Seus aplicativos"
3. Clique em "Web" e registre o app
4. Copie as configuraÃ§Ãµes do Firebase

#### **3.4. Configurar VariÃ¡veis de Ambiente**

Crie o arquivo `.env.local` na raiz do projeto:

```env
# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyC...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=sistema-presenca-ipda.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=sistema-presenca-ipda
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=sistema-presenca-ipda.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abc123

# Optional: Analytics
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-XXXXXXXXXX

# Development
NODE_ENV=development
```

### **4. Configurar Firestore Rules**

#### **4.1. Instalar Firebase CLI**

```bash
npm install -g firebase-tools
firebase login
firebase init firestore
```

#### **4.2. Deploy das Regras**

```bash
firebase deploy --only firestore:rules
```

### **5. ConfiguraÃ§Ã£o Inicial do Sistema**

#### **5.1. Criar Super UsuÃ¡rio**

1. Execute o projeto em desenvolvimento
2. Registre o primeiro usuÃ¡rio
3. No Firebase Console, adicione o campo `role: 'super'` ao documento do usuÃ¡rio

#### **5.2. Configurar Dados Iniciais**

```bash
# Executar script de configuraÃ§Ã£o inicial (se disponÃ­vel)
npm run setup:initial-data
```

### **6. Executar o Projeto**

#### **Desenvolvimento**

```bash
npm run dev
# ou
yarn dev
```

Acesse: `http://localhost:9002`

#### **ProduÃ§Ã£o Local**

```bash
npm run build
npm run start
```

#### **Com Turbopack (Mais RÃ¡pido)**

```bash
npm run dev:turbo
```

### **7. ConfiguraÃ§Ãµes AvanÃ§adas**

#### **7.1. Analytics e IA (Opcional)**

```bash
# Configurar Genkit para IA
npm run genkit:dev

# Iniciar em modo watch
npm run genkit:watch
```

#### **7.2. Configurar DomÃ­nio Personalizado**

1. No Firebase Hosting, adicione domÃ­nio customizado
2. Configure DNS para apontar para Firebase
3. SSL serÃ¡ configurado automaticamente

### **8. VerificaÃ§Ã£o da InstalaÃ§Ã£o**

#### **Checklist de VerificaÃ§Ã£o**

- [ ] âœ… PÃ¡gina inicial carrega corretamente
- [ ] ğŸ” Sistema de login funciona
- [ ] ğŸ“Š Dashboard exibe dados
- [ ] ğŸ“ FormulÃ¡rio de presenÃ§a funciona
- [ ] ğŸ‘¥ Gerenciamento de usuÃ¡rios acessÃ­vel (super usuÃ¡rios)
- [ ] âš™ï¸ ConfiguraÃ§Ãµes dinÃ¢micas respondem
- [ ] ğŸ“± Interface responsiva em mobile

#### **SoluÃ§Ã£o de Problemas Comuns**

```bash
# Limpar cache do Next.js
rm -rf .next

# Reinstalar dependÃªncias
rm -rf node_modules package-lock.json
npm install

# Verificar variÃ¡veis de ambiente
npm run env:check

# Verificar conexÃ£o Firebase
npm run firebase:test
```

---

## ğŸ—ï¸ **Estrutura do Projeto**

```
src/
â”œâ”€â”€ app/                    # App Router (Next.js 13+)
â”‚   â”œâ”€â”€ (auth)/            # PÃ¡ginas de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ admin/             # PÃ¡ginas administrativas
â”‚   â”œâ”€â”€ config/            # ConfiguraÃ§Ãµes do sistema
â”‚   â””â”€â”€ reports/           # RelatÃ³rios e analytics
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ ui/               # Componentes base (Shadcn)
â”‚   â”œâ”€â”€ auth/             # Componentes de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ layout/           # Layout e navegaÃ§Ã£o
â”‚   â””â”€â”€ admin/            # Componentes administrativos
â”œâ”€â”€ hooks/                # Custom hooks
â”œâ”€â”€ lib/                  # UtilitÃ¡rios e configuraÃ§Ãµes
â”‚   â”œâ”€â”€ firebase.ts       # ConfiguraÃ§Ã£o Firebase
â”‚   â”œâ”€â”€ auth.ts           # LÃ³gica de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ actions.ts        # Actions do Firestore
â”‚   â””â”€â”€ types.ts          # DefiniÃ§Ãµes de tipos
â””â”€â”€ styles/               # Estilos globais
```

---

## ğŸ” **Sistema de AutenticaÃ§Ã£o e SeguranÃ§a**

### **Hierarquia de UsuÃ¡rios**

#### **ğŸ”¥ Super UsuÃ¡rios (NÃ­vel 3)**

**E-mails Autorizados:**

- `admin@ipda.org.br`
- `marciodesk@ipda.app.br`

**PermissÃµes Completas:**

- âœ… **Gerenciamento Total**: Criar, editar e excluir qualquer usuÃ¡rio
- âœ… **ConfiguraÃ§Ã£o Global**: Modificar todas as configuraÃ§Ãµes do sistema
- âœ… **Dados SensÃ­veis**: Acesso a informaÃ§Ãµes confidenciais e mÃ©tricas avanÃ§adas
- âœ… **Audit Trail**: Visualizar logs completos de auditoria
- âœ… **Backup/Restore**: Gerenciar backups e restauraÃ§Ãµes
- âœ… **Sistema**: Configurar regras de negÃ³cio e validaÃ§Ãµes
- âœ… **Deploy**: Controlar atualizaÃ§Ãµes e manutenÃ§Ãµes

#### **âš™ï¸ Administradores (NÃ­vel 2)**

**PermissÃµes Administrativas:**

- âœ… **UsuÃ¡rios Comuns**: Gerenciar usuÃ¡rios nÃ£o-administrativos
- âœ… **RelatÃ³rios**: Gerar e visualizar relatÃ³rios administrativos
- âœ… **ConfiguraÃ§Ãµes BÃ¡sicas**: Modificar cargos e opÃ§Ãµes bÃ¡sicas
- âœ… **ModeraÃ§Ã£o**: Revisar e aprovar registros pendentes
- âŒ **Super FunÃ§Ãµes**: NÃ£o pode gerenciar outros admins ou super usuÃ¡rios

#### **ğŸ‘¤ UsuÃ¡rios Normais (NÃ­vel 1)**

**PermissÃµes BÃ¡sicas:**

- âœ… **Dashboard Pessoal**: Visualizar mÃ©tricas prÃ³prias
- âœ… **Registro**: Cadastrar presenÃ§as e informaÃ§Ãµes pessoais
- âœ… **RelatÃ³rios Pessoais**: Ver prÃ³prios dados e estatÃ­sticas
- âœ… **Perfil**: Editar informaÃ§Ãµes pessoais bÃ¡sicas
- âŒ **FunÃ§Ãµes Administrativas**: Sem acesso a painÃ©is administrativos

### **ğŸ›¡ï¸ ImplementaÃ§Ãµes de SeguranÃ§a**

```typescript
// VerificaÃ§Ã£o de autenticaÃ§Ã£o
const isAuthenticated = user && user.uid;

// VerificaÃ§Ã£o de nÃ­vel de acesso
const isSuperUser = user?.email && SUPER_USERS.includes(user.email);
const isAdmin = user?.role === "admin" || isSuperUser;

// Guards de proteÃ§Ã£o
<SuperUserGuard>
  <AdminPanel />
</SuperUserGuard>;
```

#### **Regras de Firestore (ProduÃ§Ã£o)**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // FunÃ§Ã£o para verificar super usuÃ¡rios
    function isSuperUser() {
      return request.auth != null &&
             request.auth.token.email in [
               'admin@ipda.org.br',
               'marciodesk@ipda.app.br'
             ];
    }

    // FunÃ§Ã£o para verificar admin
    function isAdmin() {
      return isSuperUser() ||
             (request.auth != null &&
              get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }

    // Attendance: Leitura para todos autenticados, escrita apenas para admins+
    match /attendance/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Users: Apenas super usuÃ¡rios podem gerenciar
    match /users/{document} {
      allow read: if request.auth != null;
      allow write: if isSuperUser();
      allow create: if request.auth != null && request.auth.uid == document;
    }

    // System config: Apenas admins+ podem modificar
    match /system/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
  }
}
```

#### **ValidaÃ§Ãµes Client-Side**

```typescript
// ValidaÃ§Ã£o de dados com Zod
const attendanceSchema = z.object({
  fullName: z.string().min(3, "Nome deve ter pelo menos 3 caracteres"),
  cpf: z.string().regex(/^\d{11}$/, "CPF deve ter 11 dÃ­gitos"),
  status: z.enum(["Presente", "Ausente", "Justificado"]),
  timestamp: z.date(),
});

// SanitizaÃ§Ã£o de inputs
const sanitizeInput = (input: string) => {
  return DOMPurify.sanitize(input.trim());
};
```

#### **ProteÃ§Ãµes Adicionais**

- ğŸ”’ **Rate Limiting**: Controle de requisiÃ§Ãµes por usuÃ¡rio
- ğŸ›¡ï¸ **CORS**: Configurado para domÃ­nios especÃ­ficos
- ğŸ” **Headers de SeguranÃ§a**: X-Frame-Options, CSP, HSTS
- ğŸš« **XSS Protection**: SanitizaÃ§Ã£o de inputs e outputs
- ğŸ“ **Audit Logging**: Log completo de aÃ§Ãµes crÃ­ticas
- âš ï¸ **Anomaly Detection**: DetecÃ§Ã£o de padrÃµes suspeitos

### **ğŸ” Monitoramento e Auditoria**

#### **Logs de Auditoria**

```typescript
// Log automÃ¡tico de aÃ§Ãµes crÃ­ticas
const auditLog = {
  userId: user.uid,
  userEmail: user.email,
  action: "USER_CREATED",
  targetId: newUser.uid,
  timestamp: new Date(),
  details: { role: "admin", region: "SÃ£o Paulo" },
  ipAddress: request.ip,
  userAgent: request.headers["user-agent"],
};
```

#### **Alertas de SeguranÃ§a**

- ğŸš¨ **Login Suspeito**: Tentativas de locais nÃ£o usuais
- âš ï¸ **MÃºltiplas Tentativas**: Bloqueio temporÃ¡rio apÃ³s falhas
- ğŸ“§ **NotificaÃ§Ãµes**: Email para admins em aÃ§Ãµes crÃ­ticas
- ğŸ“Š **Dashboard de SeguranÃ§a**: MÃ©tricas de seguranÃ§a em tempo real

### **ğŸ”’ Melhores PrÃ¡ticas Implementadas**

1. **PrincÃ­pio do Menor PrivilÃ©gio**: UsuÃ¡rios recebem apenas permissÃµes necessÃ¡rias
2. **SeparaÃ§Ã£o de Responsabilidades**: Diferentes nÃ­veis para diferentes funÃ§Ãµes
3. **ValidaÃ§Ã£o Dupla**: Client-side + server-side validation
4. **Criptografia**: Dados sensÃ­veis sempre criptografados
5. **SessÃµes Seguras**: Timeout automÃ¡tico e renovaÃ§Ã£o de tokens
6. **Backup de SeguranÃ§a**: Backups criptografados e versionados

---

## ğŸ”§ **InstalaÃ§Ã£o e ConfiguraÃ§Ã£o**

### **PrÃ©-requisitos**

- **Node.js 18+** - Runtime JavaScript
- **npm** ou **yarn** - Gerenciador de pacotes
- **Conta Firebase** - Backend e autenticaÃ§Ã£o
- **Git** - Controle de versÃ£o

### **1. Clone o RepositÃ³rio**

```bash
git clone https://github.com/AchillesOS/sistema-presenca-ipda.git
cd sistema-presenca-ipda
```

### **2. Instale as DependÃªncias**

```bash
# Usando npm
npm install

# Usando yarn
yarn install
```

### **3. ConfiguraÃ§Ã£o do Firebase**

#### **3.1. Criar Projeto Firebase**

1. Acesse o [Firebase Console](https://console.firebase.google.com/)
2. Clique em "Criar projeto"
3. Configure o projeto com nome: `sistema-presenca-ipda`
4. Ative Google Analytics (opcional)

#### **3.2. Configurar ServiÃ§os**

1. **Authentication**:
   - Ative o provedor "Email/senha"
   - Configure domÃ­nios autorizados
2. **Firestore Database**:
   - Crie banco no modo "produÃ§Ã£o"
   - Configure regras de seguranÃ§a
3. **Hosting** (opcional):
   - Configure para deploy automÃ¡tico

#### **3.3. Obter Credenciais**

1. VÃ¡ em "ConfiguraÃ§Ãµes do projeto"
2. Na aba "Geral", encontre "Seus aplicativos"
3. Clique em "Web" e registre o app
4. Copie as configuraÃ§Ãµes do Firebase

#### **3.4. Configurar VariÃ¡veis de Ambiente**

Crie o arquivo `.env.local` na raiz do projeto:

```env
# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyC...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=sistema-presenca-ipda.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=sistema-presenca-ipda
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=sistema-presenca-ipda.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abc123

# Optional: Analytics
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-XXXXXXXXXX

# Development
NODE_ENV=development
```

### **4. Configurar Firestore Rules**

#### **4.1. Instalar Firebase CLI**

```bash
npm install -g firebase-tools
firebase login
firebase init firestore
```

#### **4.2. Deploy das Regras**

```bash
firebase deploy --only firestore:rules
```

### **5. ConfiguraÃ§Ã£o Inicial do Sistema**

#### **5.1. Criar Super UsuÃ¡rio**

1. Execute o projeto em desenvolvimento
2. Registre o primeiro usuÃ¡rio
3. No Firebase Console, adicione o campo `role: 'super'` ao documento do usuÃ¡rio

#### **5.2. Configurar Dados Iniciais**

```bash
# Executar script de configuraÃ§Ã£o inicial (se disponÃ­vel)
npm run setup:initial-data
```

### **6. Executar o Projeto**

#### **Desenvolvimento**

```bash
npm run dev
# ou
yarn dev
```

Acesse: `http://localhost:9002`

#### **ProduÃ§Ã£o Local**

```bash
npm run build
npm run start
```

#### **Com Turbopack (Mais RÃ¡pido)**

```bash
npm run dev:turbo
```

### **7. ConfiguraÃ§Ãµes AvanÃ§adas**

#### **7.1. Analytics e IA (Opcional)**

```bash
# Configurar Genkit para IA
npm run genkit:dev

# Iniciar em modo watch
npm run genkit:watch
```

#### **7.2. Configurar DomÃ­nio Personalizado**

1. No Firebase Hosting, adicione domÃ­nio customizado
2. Configure DNS para apontar para Firebase
3. SSL serÃ¡ configurado automaticamente

### **8. VerificaÃ§Ã£o da InstalaÃ§Ã£o**

#### **Checklist de VerificaÃ§Ã£o**

- [ ] âœ… PÃ¡gina inicial carrega corretamente
- [ ] ğŸ” Sistema de login funciona
- [ ] ğŸ“Š Dashboard exibe dados
- [ ] ğŸ“ FormulÃ¡rio de presenÃ§a funciona
- [ ] ğŸ‘¥ Gerenciamento de usuÃ¡rios acessÃ­vel (super usuÃ¡rios)
- [ ] âš™ï¸ ConfiguraÃ§Ãµes dinÃ¢micas respondem
- [ ] ğŸ“± Interface responsiva em mobile

#### **SoluÃ§Ã£o de Problemas Comuns**

```bash
# Limpar cache do Next.js
rm -rf .next

# Reinstalar dependÃªncias
rm -rf node_modules package-lock.json
npm install

# Verificar variÃ¡veis de ambiente
npm run env:check

# Verificar conexÃ£o Firebase
npm run firebase:test
```

---

## ğŸ—ï¸ **Estrutura do Projeto**

```
src/
â”œâ”€â”€ app/                    # App Router (Next.js 13+)
â”‚   â”œâ”€â”€ (auth)/            # PÃ¡ginas de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ admin/             # PÃ¡ginas administrativas
â”‚   â”œâ”€â”€ config/            # ConfiguraÃ§Ãµes do sistema
â”‚   â””â”€â”€ reports/           # RelatÃ³rios e analytics
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ ui/               # Componentes base (Shadcn)
â”‚   â”œâ”€â”€ auth/             # Componentes de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ layout/           # Layout e navegaÃ§Ã£o
â”‚   â””â”€â”€ admin/            # Componentes administrativos
â”œâ”€â”€ hooks/                # Custom hooks
â”œâ”€â”€ lib/                  # UtilitÃ¡rios e configuraÃ§Ãµes
â”‚   â”œâ”€â”€ firebase.ts       # ConfiguraÃ§Ã£o Firebase
â”‚   â”œâ”€â”€ auth.ts           # LÃ³gica de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ actions.ts        # Actions do Firestore
â”‚   â””â”€â”€ types.ts          # DefiniÃ§Ãµes de tipos
â””â”€â”€ styles/               # Estilos globais
```

---

## ğŸ” **Sistema de AutenticaÃ§Ã£o e SeguranÃ§a**

### **Hierarquia de UsuÃ¡rios**

#### **ğŸ”¥ Super UsuÃ¡rios (NÃ­vel 3)**

**E-mails Autorizados:**

- `admin@ipda.org.br`
- `marciodesk@ipda.app.br`

**PermissÃµes Completas:**

- âœ… **Gerenciamento Total**: Criar, editar e excluir qualquer usuÃ¡rio
- âœ… **ConfiguraÃ§Ã£o Global**: Modificar todas as configuraÃ§Ãµes do sistema
- âœ… **Dados SensÃ­veis**: Acesso a informaÃ§Ãµes confidenciais e mÃ©tricas avanÃ§adas
- âœ… **Audit Trail**: Visualizar logs completos de auditoria
- âœ… **Backup/Restore**: Gerenciar backups e restauraÃ§Ãµes
- âœ… **Sistema**: Configurar regras de negÃ³cio e validaÃ§Ãµes
- âœ… **Deploy**: Controlar atualizaÃ§Ãµes e manutenÃ§Ãµes

#### **âš™ï¸ Administradores (NÃ­vel 2)**

**PermissÃµes Administrativas:**

- âœ… **UsuÃ¡rios Comuns**: Gerenciar usuÃ¡rios nÃ£o-administrativos
- âœ… **RelatÃ³rios**: Gerar e visualizar relatÃ³rios administrativos
- âœ… **ConfiguraÃ§Ãµes BÃ¡sicas**: Modificar cargos e opÃ§Ãµes bÃ¡sicas
- âœ… **ModeraÃ§Ã£o**: Revisar e aprovar registros pendentes
- âŒ **Super FunÃ§Ãµes**: NÃ£o pode gerenciar outros admins ou super usuÃ¡rios

#### **ğŸ‘¤ UsuÃ¡rios Normais (NÃ­vel 1)**

**PermissÃµes BÃ¡sicas:**

- âœ… **Dashboard Pessoal**: Visualizar mÃ©tricas prÃ³prias
- âœ… **Registro**: Cadastrar presenÃ§as e informaÃ§Ãµes pessoais
- âœ… **RelatÃ³rios Pessoais**: Ver prÃ³prios dados e estatÃ­sticas
- âœ… **Perfil**: Editar informaÃ§Ãµes pessoais bÃ¡sicas
- âŒ **FunÃ§Ãµes Administrativas**: Sem acesso a painÃ©is administrativos

### **ğŸ›¡ï¸ ImplementaÃ§Ãµes de SeguranÃ§a**

```typescript
// VerificaÃ§Ã£o de autenticaÃ§Ã£o
const isAuthenticated = user && user.uid;

// VerificaÃ§Ã£o de nÃ­vel de acesso
const isSuperUser = user?.email && SUPER_USERS.includes(user.email);
const isAdmin = user?.role === "admin" || isSuperUser;

// Guards de proteÃ§Ã£o
<SuperUserGuard>
  <AdminPanel />
</SuperUserGuard>;
```

#### **Regras de Firestore (ProduÃ§Ã£o)**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // FunÃ§Ã£o para verificar super usuÃ¡rios
    function isSuperUser() {
      return request.auth != null &&
             request.auth.token.email in [
               'admin@ipda.org.br',
               'marciodesk@ipda.app.br'
             ];
    }

    // FunÃ§Ã£o para verificar admin
    function isAdmin() {
      return isSuperUser() ||
             (request.auth != null &&
              get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }

    // Attendance: Leitura para todos autenticados, escrita apenas para admins+
    match /attendance/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Users: Apenas super usuÃ¡rios podem gerenciar
    match /users/{document} {
      allow read: if request.auth != null;
      allow write: if isSuperUser();
      allow create: if request.auth != null && request.auth.uid == document;
    }

    // System config: Apenas admins+ podem modificar
    match /system/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
  }
}
```

#### **ValidaÃ§Ãµes Client-Side**

```typescript
// ValidaÃ§Ã£o de dados com Zod
const attendanceSchema = z.object({
  fullName: z.string().min(3, "Nome deve ter pelo menos 3 caracteres"),
  cpf: z.string().regex(/^\d{11}$/, "CPF deve ter 11 dÃ­gitos"),
  status: z.enum(["Presente", "Ausente", "Justificado"]),
  timestamp: z.date(),
});

// SanitizaÃ§Ã£o de inputs
const sanitizeInput = (input: string) => {
  return DOMPurify.sanitize(input.trim());
};
```

#### **ProteÃ§Ãµes Adicionais**

- ğŸ”’ **Rate Limiting**: Controle de requisiÃ§Ãµes por usuÃ¡rio
- ğŸ›¡ï¸ **CORS**: Configurado para domÃ­nios especÃ­ficos
- ğŸ” **Headers de SeguranÃ§a**: X-Frame-Options, CSP, HSTS
- ğŸš« **XSS Protection**: SanitizaÃ§Ã£o de inputs e outputs
- ğŸ“ **Audit Logging**: Log completo de aÃ§Ãµes crÃ­ticas
- âš ï¸ **Anomaly Detection**: DetecÃ§Ã£o de padrÃµes suspeitos

### **ğŸ” Monitoramento e Auditoria**

#### **Logs de Auditoria**

```typescript
// Log automÃ¡tico de aÃ§Ãµes crÃ­ticas
const auditLog = {
  userId: user.uid,
  userEmail: user.email,
  action: "USER_CREATED",
  targetId: newUser.uid,
  timestamp: new Date(),
  details: { role: "admin", region: "SÃ£o Paulo" },
  ipAddress: request.ip,
  userAgent: request.headers["user-agent"],
};
```

#### **Alertas de SeguranÃ§a**

- ğŸš¨ **Login Suspeito**: Tentativas de locais nÃ£o usuais
- âš ï¸ **MÃºltiplas Tentativas**: Bloqueio temporÃ¡rio apÃ³s falhas
- ğŸ“§ **NotificaÃ§Ãµes**: Email para admins em aÃ§Ãµes crÃ­ticas
- ğŸ“Š **Dashboard de SeguranÃ§a**: MÃ©tricas de seguranÃ§a em tempo real

### **ğŸ”’ Melhores PrÃ¡ticas Implementadas**

1. **PrincÃ­pio do Menor PrivilÃ©gio**: UsuÃ¡rios recebem apenas permissÃµes necessÃ¡rias
2. **SeparaÃ§Ã£o de Responsabilidades**: Diferentes nÃ­veis para diferentes funÃ§Ãµes
3. **ValidaÃ§Ã£o Dupla**: Client-side + server-side validation
4. **Criptografia**: Dados sensÃ­veis sempre criptografados
5. **SessÃµes Seguras**: Timeout automÃ¡tico e renovaÃ§Ã£o de tokens
6. **Backup de SeguranÃ§a**: Backups criptografados e versionados

---

## ğŸ”§ **InstalaÃ§Ã£o e ConfiguraÃ§Ã£o**

### **PrÃ©-requisitos**

- **Node.js 18+** - Runtime JavaScript
- **npm** ou **yarn** - Gerenciador de pacotes
- **Conta Firebase** - Backend e autenticaÃ§Ã£o
- **Git** - Controle de versÃ£o

### **1. Clone o RepositÃ³rio**

```bash
git clone https://github.com/AchillesOS/sistema-presenca-ipda.git
cd sistema-presenca-ipda
```

### **2. Instale as DependÃªncias**

```bash
# Usando npm
npm install

# Usando yarn
yarn install
```

### **3. ConfiguraÃ§Ã£o do Firebase**

#### **3.1. Criar Projeto Firebase**

1. Acesse o [Firebase Console](https://console.firebase.google.com/)
2. Clique em "Criar projeto"
3. Configure o projeto com nome: `sistema-presenca-ipda`
4. Ative Google Analytics (opcional)

#### **3.2. Configurar ServiÃ§os**

1. **Authentication**:
   - Ative o provedor "Email/senha"
   - Configure domÃ­nios autorizados
2. **Firestore Database**:
   - Crie banco no modo "produÃ§Ã£o"
   - Configure regras de seguranÃ§a
3. **Hosting** (opcional):
   - Configure para deploy automÃ¡tico

#### **3.3. Obter Credenciais**

1. VÃ¡ em "ConfiguraÃ§Ãµes do projeto"
2. Na aba "Geral", encontre "Seus aplicativos"
3. Clique em "Web" e registre o app
4. Copie as configuraÃ§Ãµes do Firebase

#### **3.4. Configurar VariÃ¡veis de Ambiente**

Crie o arquivo `.env.local` na raiz do projeto:

```env
# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyC...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=sistema-presenca-ipda.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=sistema-presenca-ipda
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=sistema-presenca-ipda.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abc123

# Optional: Analytics
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-XXXXXXXXXX

# Development
NODE_ENV=development
```

### **4. Configurar Firestore Rules**

#### **4.1. Instalar Firebase CLI**

```bash
npm install -g firebase-tools
firebase login
firebase init firestore
```

#### **4.2. Deploy das Regras**

```bash
firebase deploy --only firestore:rules
```

### **5. ConfiguraÃ§Ã£o Inicial do Sistema**

#### **5.1. Criar Super UsuÃ¡rio**

1. Execute o projeto em desenvolvimento
2. Registre o primeiro usuÃ¡rio
3. No Firebase Console, adicione o campo `role: 'super'` ao documento do usuÃ¡rio

#### **5.2. Configurar Dados Iniciais**

```bash
# Executar script de configuraÃ§Ã£o inicial (se disponÃ­vel)
npm run setup:initial-data
```

### **6. Executar o Projeto**

#### **Desenvolvimento**

```bash
npm run dev
# ou
yarn dev
```

Acesse: `http://localhost:9002`

#### **ProduÃ§Ã£o Local**

```bash
npm run build
npm run start
```

#### **Com Turbopack (Mais RÃ¡pido)**

```bash
npm run dev:turbo
```

### **7. ConfiguraÃ§Ãµes AvanÃ§adas**

#### **7.1. Analytics e IA (Opcional)**

```bash
# Configurar Genkit para IA
npm run genkit:dev

# Iniciar em modo watch
npm run genkit:watch
```

#### **7.2. Configurar DomÃ­nio Personalizado**

1. No Firebase Hosting, adicione domÃ­nio customizado
2. Configure DNS para apontar para Firebase
3. SSL serÃ¡ configurado automaticamente

### **8. VerificaÃ§Ã£o da InstalaÃ§Ã£o**

#### **Checklist de VerificaÃ§Ã£o**

- [ ] âœ… PÃ¡gina inicial carrega corretamente
- [ ] ğŸ” Sistema de login funciona
- [ ] ğŸ“Š Dashboard exibe dados
- [ ] ğŸ“ FormulÃ¡rio de presenÃ§a funciona
- [ ] ğŸ‘¥ Gerenciamento de usuÃ¡rios acessÃ­vel (super usuÃ¡rios)
- [ ] âš™ï¸ ConfiguraÃ§Ãµes dinÃ¢micas respondem
- [ ] ğŸ“± Interface responsiva em mobile

#### **SoluÃ§Ã£o de Problemas Comuns**

```bash
# Limpar cache do Next.js
rm -rf .next

# Reinstalar dependÃªncias
rm -rf node_modules package-lock.json
npm install

# Verificar variÃ¡veis de ambiente
npm run env:check

# Verificar conexÃ£o Firebase
npm run firebase:test
```

---

## ğŸ—ï¸ **Estrutura do Projeto**

```
src/
â”œâ”€â”€ app/                    # App Router (Next.js 13+)
â”‚   â”œâ”€â”€ (auth)/            # PÃ¡ginas de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ admin/             # PÃ¡ginas administrativas
â”‚   â”œâ”€â”€ config/            # ConfiguraÃ§Ãµes do sistema
â”‚   â””â”€â”€ reports/           # RelatÃ³rios e analytics
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ ui/               # Componentes base (Shadcn)
â”‚   â”œâ”€â”€ auth/             # Componentes de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ layout/           # Layout e navegaÃ§Ã£o
â”‚   â””â”€â”€ admin/            # Componentes administrativos
â”œâ”€â”€ hooks/                # Custom hooks
â”œâ”€â”€ lib/                  # UtilitÃ¡rios e configuraÃ§Ãµes
â”‚   â”œâ”€â”€ firebase.ts       # ConfiguraÃ§Ã£o Firebase
â”‚   â”œâ”€â”€ auth.ts           # LÃ³gica de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ actions.ts        # Actions do Firestore
â”‚   â””â”€â”€ types.ts          # DefiniÃ§Ãµes de tipos
â””â”€â”€ styles/               # Estilos globais
```

---

## ğŸ” **Sistema de AutenticaÃ§Ã£o e SeguranÃ§a**

### **Hierarquia de UsuÃ¡rios**

#### **ğŸ”¥ Super UsuÃ¡rios (NÃ­vel 3)**

**E-mails Autorizados:**

- `admin@ipda.org.br`
- `marciodesk@ipda.app.br`

**PermissÃµes Completas:**

- âœ… **Gerenciamento Total**: Criar, editar e excluir qualquer usuÃ¡rio
- âœ… **ConfiguraÃ§Ã£o Global**: Modificar todas as configuraÃ§Ãµes do sistema
- âœ… **Dados SensÃ­veis**: Acesso a informaÃ§Ãµes confidenciais e mÃ©tricas avanÃ§adas
- âœ… **Audit Trail**: Visualizar logs completos de auditoria
- âœ… **Backup/Restore**: Gerenciar backups e restauraÃ§Ãµes
- âœ… **Sistema**: Configurar regras de negÃ³cio e validaÃ§Ãµes
- âœ… **Deploy**: Controlar atualizaÃ§Ãµes e manutenÃ§Ãµes

#### **âš™ï¸ Administradores (NÃ­vel 2)**

**PermissÃµes Administrativas:**

- âœ… **UsuÃ¡rios Comuns**: Gerenciar usuÃ¡rios nÃ£o-administrativos
- âœ… **RelatÃ³rios**: Gerar e visualizar relatÃ³rios administrativos
- âœ… **ConfiguraÃ§Ãµes BÃ¡sicas**: Modificar cargos e opÃ§Ãµes bÃ¡sicas
- âœ… **ModeraÃ§Ã£o**: Revisar e aprovar registros pendentes
- âŒ **Super FunÃ§Ãµes**: NÃ£o pode gerenciar outros admins ou super usuÃ¡rios

#### **ğŸ‘¤ UsuÃ¡rios Normais (NÃ­vel 1)**

**PermissÃµes BÃ¡sicas:**

- âœ… **Dashboard Pessoal**: Visualizar mÃ©tricas prÃ³prias
- âœ… **Registro**: Cadastrar presenÃ§as e informaÃ§Ãµes pessoais
- âœ… **RelatÃ³rios Pessoais**: Ver prÃ³prios dados e estatÃ­sticas
- âœ… **Perfil**: Editar informaÃ§Ãµes pessoais bÃ¡sicas
- âŒ **FunÃ§Ãµes Administrativas**: Sem acesso a painÃ©is administrativos

### **ğŸ›¡ï¸ ImplementaÃ§Ãµes de SeguranÃ§a**

```typescript
// VerificaÃ§Ã£o de autenticaÃ§Ã£o
const isAuthenticated = user && user.uid;

// VerificaÃ§Ã£o de nÃ­vel de acesso
const isSuperUser = user?.email && SUPER_USERS.includes(user.email);
const isAdmin = user?.role === "admin" || isSuperUser;

// Guards de proteÃ§Ã£o
<SuperUserGuard>
  <AdminPanel />
</SuperUserGuard>;
```

#### **Regras de Firestore (ProduÃ§Ã£o)**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // FunÃ§Ã£o para verificar super usuÃ¡rios
    function isSuperUser() {
      return request.auth != null &&
             request.auth.token.email in [
               'admin@ipda.org.br',
               'marciodesk@ipda.app.br'
             ];
    }

    // FunÃ§Ã£o para verificar admin
    function isAdmin() {
      return isSuperUser() ||
             (request.auth != null &&
              get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }

    // Attendance: Leitura para todos autenticados, escrita apenas para admins+
    match /attendance/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Users: Apenas super usuÃ¡rios podem gerenciar
    match /users/{document} {
      allow read: if request.auth != null;
      allow write: if isSuperUser();
      allow create: if request.auth != null && request.auth.uid == document;
    }

    // System config: Apenas admins+ podem modificar
    match /system/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
  }
}
```

#### **ValidaÃ§Ãµes Client-Side**

```typescript
// ValidaÃ§Ã£o de dados com Zod
const attendanceSchema = z.object({
  fullName: z.string().min(3, "Nome deve ter pelo menos 3 caracteres"),
  cpf: z.string().regex(/^\d{11}$/, "CPF deve ter 11 dÃ­gitos"),
  status: z.enum(["Presente", "Ausente", "Justificado"]),
  timestamp: z.date(),
});

// SanitizaÃ§Ã£o de inputs
const sanitizeInput = (input: string) => {
  return DOMPurify.sanitize(input.trim());
};
```

#### **ProteÃ§Ãµes Adicionais**

- ğŸ”’ **Rate Limiting**: Controle de requisiÃ§Ãµes por usuÃ¡rio
- ğŸ›¡ï¸ **CORS**: Configurado para domÃ­nios especÃ­ficos
- ğŸ” **Headers de SeguranÃ§a**: X-Frame-Options, CSP, HSTS
- ğŸš« **XSS Protection**: SanitizaÃ§Ã£o de inputs e outputs
- ğŸ“ **Audit Logging**: Log completo de aÃ§Ãµes crÃ­ticas
- âš ï¸ **Anomaly Detection**: DetecÃ§Ã£o de padrÃµes suspeitos

### **ğŸ” Monitoramento e Auditoria**

#### **Logs de Auditoria**

```typescript
// Log automÃ¡tico de aÃ§Ãµes crÃ­ticas
const auditLog = {
  userId: user.uid,
  userEmail: user.email,
  action: "USER_CREATED",
  targetId: newUser.uid,
  timestamp: new Date(),
  details: { role: "admin", region: "SÃ£o Paulo" },
  ipAddress: request.ip,
  userAgent: request.headers["user-agent"],
};
```

#### **Alertas de SeguranÃ§a**

- ğŸš¨ **Login Suspeito**: Tentativas de locais nÃ£o usuais
- âš ï¸ **MÃºltiplas Tentativas**: Bloqueio temporÃ¡rio apÃ³s falhas
- ğŸ“§ **NotificaÃ§Ãµes**: Email para admins em aÃ§Ãµes crÃ­ticas
- ğŸ“Š **Dashboard de SeguranÃ§a**: MÃ©tricas de seguranÃ§a em tempo real

### **ğŸ”’ Melhores PrÃ¡ticas Implementadas**

1. **PrincÃ­pio do Menor PrivilÃ©gio**: UsuÃ¡rios recebem apenas permissÃµes necessÃ¡rias
2. **SeparaÃ§Ã£o de Responsabilidades**: Diferentes nÃ­veis para diferentes funÃ§Ãµes
3. **ValidaÃ§Ã£o Dupla**: Client-side + server-side validation
4. **Criptografia**: Dados sensÃ­veis sempre criptografados
5. **SessÃµes Seguras**: Timeout automÃ¡tico e renovaÃ§Ã£o de tokens
6. **Backup de SeguranÃ§a**: Backups criptografados e versionados

---

## ğŸ”§ **InstalaÃ§Ã£o e ConfiguraÃ§Ã£o**

### **PrÃ©-requisitos**

- **Node.js 18+** - Runtime JavaScript
- **npm** ou **yarn** - Gerenciador de pacotes
- **Conta Firebase** - Backend e autenticaÃ§Ã£o
- **Git** - Controle de versÃ£o

### **1. Clone o RepositÃ³rio**

```bash
git clone https://github.com/AchillesOS/sistema-presenca-ipda.git
cd sistema-presenca-ipda
```

### **2. Instale as DependÃªncias**

```bash
# Usando npm
npm install

# Usando yarn
yarn install
```

### **3. ConfiguraÃ§Ã£o do Firebase**

#### **3.1. Criar Projeto Firebase**

1. Acesse o [Firebase Console](https://console.firebase.google.com/)
2. Clique em "Criar projeto"
3. Configure o projeto com nome: `sistema-presenca-ipda`
4. Ative Google Analytics (opcional)

#### **3.2. Configurar ServiÃ§os**

1. **Authentication**:
   - Ative o provedor "Email/senha"
   - Configure domÃ­nios autorizados
2. **Firestore Database**:
   - Crie banco no modo "produÃ§Ã£o"
   - Configure regras de seguranÃ§a
3. **Hosting** (opcional):
   - Configure para deploy automÃ¡tico

#### **3.3. Obter Credenciais**

1. VÃ¡ em "ConfiguraÃ§Ãµes do projeto"
2. Na aba "Geral", encontre "Seus aplicativos"
3. Clique em "Web" e registre o app
4. Copie as configuraÃ§Ãµes do Firebase

#### **3.4. Configurar VariÃ¡veis de Ambiente**

Crie o arquivo `.env.local` na raiz do projeto:

```env
# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyC...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=sistema-presenca-ipda.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=sistema-presenca-ipda
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=sistema-presenca-ipda.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abc123

# Optional: Analytics
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-XXXXXXXXXX

# Development
NODE_ENV=development
```

### **4. Configurar Firestore Rules**

#### **4.1. Instalar Firebase CLI**

```bash
npm install -g firebase-tools
firebase login
firebase init firestore
```

#### **4.2. Deploy das Regras**

```bash
firebase deploy --only firestore:rules
```

### **5. ConfiguraÃ§Ã£o Inicial do Sistema**

#### **5.1. Criar Super UsuÃ¡rio**

1. Execute o projeto em desenvolvimento
2. Registre o primeiro usuÃ¡rio
3. No Firebase Console, adicione o campo `role: 'super'` ao documento do usuÃ¡rio

#### **5.2. Configurar Dados Iniciais**

```bash
# Executar script de configuraÃ§Ã£o inicial (se disponÃ­vel)
npm run setup:initial-data
```

### **6. Executar o Projeto**

#### **Desenvolvimento**

```bash
npm run dev
# ou
yarn dev
```

Acesse: `http://localhost:9002`

#### **ProduÃ§Ã£o Local**

```bash
npm run build
npm run start
```

#### **Com Turbopack (Mais RÃ¡pido)**

```bash
npm run dev:turbo
```

### **7. ConfiguraÃ§Ãµes AvanÃ§adas**

#### **7.1. Analytics e IA (Opcional)**

```bash
# Configurar Genkit para IA
npm run genkit:dev

# Iniciar em modo watch
npm run genkit:watch
```

#### **7.2. Configurar DomÃ­nio Personalizado**

1. No Firebase Hosting, adicione domÃ­nio customizado
2. Configure DNS para apontar para Firebase
3. SSL serÃ¡ configurado automaticamente

### **8. VerificaÃ§Ã£o da InstalaÃ§Ã£o**

#### **Checklist de VerificaÃ§Ã£o**

- [ ] âœ… PÃ¡gina inicial carrega corretamente
- [ ] ğŸ” Sistema de login funciona
- [ ] ğŸ“Š Dashboard exibe dados
- [ ] ğŸ“ FormulÃ¡rio de presenÃ§a funciona
- [ ] ğŸ‘¥ Gerenciamento de usuÃ¡rios acessÃ­vel (super usuÃ¡rios)
- [ ] âš™ï¸ ConfiguraÃ§Ãµes dinÃ¢micas respondem
- [ ] ğŸ“± Interface responsiva em mobile

#### **SoluÃ§Ã£o de Problemas Comuns**

```bash
# Limpar cache do Next.js
rm -rf .next

# Reinstalar dependÃªncias
rm -rf node_modules package-lock.json
npm install

# Verificar variÃ¡veis de ambiente
npm run env:check

# Verificar conexÃ£o Firebase
npm run firebase:test
```

---

## ğŸ—ï¸ **Estrutura do Projeto**

```
src/
â”œâ”€â”€ app/                    # App Router (Next.js 13+)
â”‚   â”œâ”€â”€ (auth)/            # PÃ¡ginas de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ admin/             # PÃ¡ginas administrativas
â”‚   â”œâ”€â”€ config/            # ConfiguraÃ§Ãµes do sistema
â”‚   â””â”€â”€ reports/           # RelatÃ³rios e analytics
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ ui/               # Componentes base (Shadcn)
â”‚   â”œâ”€â”€ auth/             # Componentes de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ layout/           # Layout e navegaÃ§Ã£o
â”‚   â””â”€â”€ admin/            # Componentes administrativos
â”œâ”€â”€ hooks/                # Custom hooks
â”œâ”€â”€ lib/                  # UtilitÃ¡rios e configuraÃ§Ãµes
â”‚   â”œâ”€â”€ firebase.ts       # ConfiguraÃ§Ã£o Firebase
â”‚   â”œâ”€â”€ auth.ts           # LÃ³gica de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ actions.ts        # Actions do Firestore
â”‚   â””â”€â”€ types.ts          # DefiniÃ§Ãµes de tipos
â””â”€â”€ styles/               # Estilos globais
```

---

## ğŸ” **Sistema de AutenticaÃ§Ã£o e SeguranÃ§a**

### **Hierarquia de UsuÃ¡rios**

#### **ğŸ”¥ Super UsuÃ¡rios (NÃ­vel 3)**

**E-mails Autorizados:**

- `admin@ipda.org.br`
- `marciodesk@ipda.app.br`

**PermissÃµes Completas:**

- âœ… **Gerenciamento Total**: Criar, editar e excluir qualquer usuÃ¡rio
- âœ… **ConfiguraÃ§Ã£o Global**: Modificar todas as configuraÃ§Ãµes do sistema
- âœ… **Dados SensÃ­veis**: Acesso a informaÃ§Ãµes confidenciais e mÃ©tricas avanÃ§adas
- âœ… **Audit Trail**: Visualizar logs completos de auditoria
- âœ… **Backup/Restore**: Gerenciar backups e restauraÃ§Ãµes
- âœ… **Sistema**: Configurar regras de negÃ³cio e validaÃ§Ãµes
- âœ… **Deploy**: Controlar atualizaÃ§Ãµes e manutenÃ§Ãµes

#### **âš™ï¸ Administradores (NÃ­vel 2)**

**PermissÃµes Administrativas:**

- âœ… **UsuÃ¡rios Comuns**: Gerenciar usuÃ¡rios nÃ£o-administrativos
- âœ… **RelatÃ³rios**: Gerar e visualizar relatÃ³rios administrativos
- âœ… **ConfiguraÃ§Ãµes BÃ¡sicas**: Modificar cargos e opÃ§Ãµes bÃ¡sicas
- âœ… **ModeraÃ§Ã£o**: Revisar e aprovar registros pendentes
- âŒ **Super FunÃ§Ãµes**: NÃ£o pode gerenciar outros admins ou super usuÃ¡rios

#### **ğŸ‘¤ UsuÃ¡rios Normais (NÃ­vel 1)**

**PermissÃµes BÃ¡sicas:**

- âœ… **Dashboard Pessoal**: Visualizar mÃ©tricas prÃ³prias
- âœ… **Registro**: Cadastrar presenÃ§as e informaÃ§Ãµes pessoais
- âœ… **RelatÃ³rios Pessoais**: Ver prÃ³prios dados e estatÃ­sticas
- âœ… **Perfil**: Editar informaÃ§Ãµes pessoais bÃ¡sicas
- âŒ **FunÃ§Ãµes Administrativas**: Sem acesso a painÃ©is administrativos

### **ğŸ›¡ï¸ ImplementaÃ§Ãµes de SeguranÃ§a**

```typescript
// VerificaÃ§Ã£o de autenticaÃ§Ã£o
const isAuthenticated = user && user.uid;

// VerificaÃ§Ã£o de nÃ­vel de acesso
const isSuperUser = user?.email && SUPER_USERS.includes(user.email);
const isAdmin = user?.role === "admin" || isSuperUser;

// Guards de proteÃ§Ã£o
<SuperUserGuard>
  <AdminPanel />
</SuperUserGuard>;
```

#### **Regras de Firestore (ProduÃ§Ã£o)**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // FunÃ§Ã£o para verificar super usuÃ¡rios
    function isSuperUser() {
      return request.auth != null &&
             request.auth.token.email in [
               'admin@ipda.org.br',
               'marciodesk@ipda.app.br'
             ];
    }

    // FunÃ§Ã£o para verificar admin
    function isAdmin() {
      return isSuperUser() ||
             (request.auth != null &&
              get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }

    // Attendance: Leitura para todos autenticados, escrita apenas para admins+
    match /attendance/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Users: Apenas super usuÃ¡rios podem gerenciar
    match /users/{document} {
      allow read: if request.auth != null;
      allow write: if isSuperUser();
      allow create: if request.auth != null && request.auth.uid == document;
    }

    // System config: Apenas admins+ podem modificar
    match /system/{document} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
  }
}
```

#### **ValidaÃ§Ãµes Client-Side**

```typescript
// ValidaÃ§Ã£o de dados com Zod
const attendanceSchema = z.object({
  fullName: z.string().min(3, "Nome deve ter pelo menos 3 caracteres"),
  cpf: z.string().regex(/^\d{11}$/, "CPF deve ter 11 dÃ­gitos"),
  status: z.enum(["Presente", "Ausente", "Justificado"]),
  timestamp: z.date(),
});

// SanitizaÃ§Ã£o de inputs
const sanitizeInput = (input: string) => {
  return DOMPurify.sanitize(input.trim());
};
```

#### **ProteÃ§Ãµes Adicionais**

- ğŸ”’ **Rate Limiting**: Controle de requisiÃ§Ãµes por usuÃ¡rio
- ğŸ›¡ï¸ **CORS**: Configurado para domÃ­nios especÃ­ficos
- ğŸ” **Headers de SeguranÃ§a**: X-Frame-Options, CSP, HSTS
- ğŸš« **XSS Protection**: SanitizaÃ§Ã£o de inputs e outputs
- ğŸ“ **Audit Logging**: Log completo de aÃ§Ãµes crÃ­ticas
- âš ï¸ **Anomaly Detection**: DetecÃ§Ã£o de padrÃµes suspeitos

### **ğŸ” Monitoramento e Auditoria**

#### **Logs de Auditoria**

```typescript
// Log automÃ¡tico de aÃ§Ãµes crÃ­ticas
const auditLog = {
  userId: user.uid,
  userEmail: user.email,
  action: "USER_CREATED",
  targetId: newUser.uid,
  timestamp: new Date(),
  details: { role: "admin", region: "SÃ£o Paulo" },
  ipAddress: request.ip,
  userAgent: request.headers["user-agent"],
};
```

#### **Alertas de SeguranÃ§a**

- ğŸš¨ **Login Suspeito**: Tentativas de locais nÃ£o usuais
- âš ï¸ **MÃºltiplas Tentativas**: Bloqueio temporÃ¡rio apÃ³s falhas
- ğŸ“§ **NotificaÃ§Ãµes**: Email para admins em aÃ§Ãµes crÃ­ticas
- ğŸ“Š **Dashboard de SeguranÃ§a**: MÃ©tricas de seguranÃ§a em tempo real

### **ğŸ”’ Melhores PrÃ¡ticas Implementadas**

1. **PrincÃ­pio do Menor PrivilÃ©gio**: UsuÃ¡rios recebem apenas permissÃµes necessÃ¡rias
2. **SeparaÃ§Ã£o de Responsabilidades**: Diferentes nÃ­veis para diferentes funÃ§Ãµes
3. **ValidaÃ§Ã£o Dupla**: Client-side + server-side validation
4. **Criptografia**: Dados sensÃ­veis sempre criptografados
5. **SessÃµes Seguras**: Timeout automÃ¡tico e renovaÃ§Ã£o de tokens
6. **Backup de SeguranÃ§a**: Backups criptografados e versionados

---

## ğŸ”§ **InstalaÃ§Ã£o e ConfiguraÃ§Ã£o**

### **PrÃ©-requisitos**

- **Node.js 18+** - Runtime JavaScript
- **npm** ou **yarn** - Gerenciador de pacotes
- **Conta Firebase** - Backend e autenticaÃ§Ã£o
- **Git** - Controle de versÃ£o

### **1. Clone o RepositÃ³rio**

```bash
git clone https://github.com/AchillesOS/sistema-presenca-ipda.git
cd sistema-presenca-ipda
```

### **2. Instale as DependÃªncias**

```bash
# Usando npm
npm install

# Usando yarn
yarn install
```

### **3. ConfiguraÃ§Ã£o do Firebase**

#### **3.1. Criar Projeto Firebase**

1. Acesse o [Firebase Console](https://console.firebase.google.com/)
2. Clique em "Criar projeto"
3. Configure o projeto com nome: `sistema-presenca-ipda`
4. Ative Google Analytics (opcional)

#### **3.2. Configurar ServiÃ§os**

1. **Authentication**:
   - Ative o provedor "Email/senha"
   - Configure domÃ­nios autorizados
2. **Firestore Database**:
   - Crie banco no modo "produÃ§Ã£o"
   - Configure regras de seguranÃ§a
3. **Hosting** (opcional):
   - Configure para deploy automÃ¡tico

#### **3.3. Obter Credenciais**

1. VÃ¡ em "ConfiguraÃ§Ãµes do projeto"
2. Na aba "Geral", encontre "Seus aplicativos"
3. Clique em "Web" e registre o app
4. Copie as configuraÃ§Ãµes do Firebase

#### **3.4. Configurar VariÃ¡veis de Ambiente**

Crie o arquivo `.env.local` na raiz do projeto:

```env
# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyC...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=sistema-presenca-ipda.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=sistema-presenca-ipda
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=sistema-presenca-ipda.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abc123

# Optional: Analytics
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-XXXXXXXXXX

# Development
NODE_ENV=development
```

### **4. Configurar Firestore Rules**

#### **4.1. Instalar Firebase CLI**

```bash
npm install -g firebase-tools
firebase login
firebase init firestore
```

#### **4.2. Deploy das Regras**

```bash
firebase deploy --only firestore:rules
```

### **5. ConfiguraÃ§Ã£o Inicial do Sistema**

#### **5.1. Criar Super UsuÃ¡rio**

1. Execute o projeto em desenvolvimento
2. Registre o primeiro usuÃ¡rio
3. No Firebase Console, adicione o campo `role: 'super'` ao documento do usuÃ¡rio

#### **5.2. Configurar Dados Iniciais**

```bash
# Executar script de configuraÃ§Ã£o inicial (se disponÃ­vel)
npm run setup:initial-data
```

### **6. Executar o Projeto**

#### **Desenvolvimento**

```bash
npm run dev
# ou
yarn dev
```

Acesse: `http://localhost:9002`

#### **ProduÃ§Ã£o Local**

```bash
npm run build
npm run start
```

#### **Com Turbopack (Mais RÃ¡pido)**

```bash
npm run dev:turbo
```

### **7. ConfiguraÃ§Ãµes AvanÃ§adas**

#### **7.1. Analytics e IA (Opcional)**

```bash
# Configurar Genkit para IA
npm run genkit:dev

# Iniciar em modo watch
npm run genkit:watch
```

#### **7.2. Configurar DomÃ­nio Personalizado**

1. No Firebase Hosting, adicione domÃ­nio customizado
2. Configure DNS para apontar para Firebase
3. SSL serÃ¡ configurado automaticamente

### **8. VerificaÃ§Ã£o da InstalaÃ§Ã£o**

#### **Checklist de VerificaÃ§Ã£o**

- [ ] âœ… PÃ¡gina inicial carrega corretamente
- [ ] ğŸ” Sistema de login funciona
- [ ] ğŸ“Š Dashboard exibe dados
- [ ] ğŸ“ FormulÃ¡rio de presenÃ§a funciona
- [ ] ğŸ‘¥ Gerenciamento de usuÃ¡rios acessÃ­vel (super usuÃ¡rios)
- [ ] âš™ï¸ ConfiguraÃ§Ãµes dinÃ¢micas respondem
- [ ] ğŸ“± Interface responsiva em mobile

#### **SoluÃ§Ã£o de Problemas Comuns**

```bash
# Limpar cache do Next.js
rm -rf .next

# Reinstalar dependÃªncias
rm -rf node_modules package-lock.json
npm install

# Verificar variÃ¡veis de ambiente
npm run env:check

# Verificar conexÃ£o Firebase
npm run firebase:test
```

---

## ğŸ—ï¸ **Estrutura do Projeto**

```
src/
â”œâ”€â”€ app/                    # App Router (Next.js 13+)
â”‚   â”œâ”€â”€ (auth)/            # PÃ¡ginas de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ admin/             # PÃ¡ginas administrativas
â”‚   â”œâ”€â”€ config/            # ConfiguraÃ§Ãµes do sistema
â”‚   â””â”€â”€ reports/           # RelatÃ³rios e analytics
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ ui/               # Componentes base (Shadcn)
â”‚   â”œâ”€â”€ auth/             # Componentes de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ layout/           # Layout e navegaÃ§Ã£o
â”‚   â””â”€â”€ admin/            # Componentes administrativos
â”œâ”€â”€ hooks/                # Custom hooks
â”œâ”€â”€ lib/                  # UtilitÃ¡rios e configuraÃ§Ãµes
â”‚   â”œâ”€â”€ firebase.ts       # ConfiguraÃ§Ã£o Firebase
â”‚   â”œâ”€â”€ auth.ts           # LÃ³gica de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ actions.ts        # Actions do Firestore
â”‚   â””â”€â”€ types.ts          # DefiniÃ§Ãµes de tipos
â””â”€â”€ styles/               # Estilos globais
```

---

## ğŸ” **Sistema de AutenticaÃ§Ã£o e SeguranÃ§a**

### **Hierarquia de UsuÃ¡rios**

#### **ğŸ”¥ Super UsuÃ¡rios (NÃ­vel 3)**

**E-mails Autorizados:**

- `admin@ipda.org.br`
- `marciodesk@ipda.app.br`

**PermissÃµes Completas:**

- âœ… **Gerenciamento Total**: Criar, editar e excluir qualquer usuÃ¡rio
- âœ… **ConfiguraÃ§Ã£o Global**: Modificar todas as configuraÃ§Ãµes do sistema
- âœ… **Dados SensÃ­veis**: Acesso a informaÃ§Ãµes confidenciais e mÃ©tricas avanÃ§adas
- âœ… **Audit Trail**: Visualizar logs completos de auditoria
- âœ… **Backup/Restore**: Gerenciar backups e restauraÃ§Ãµes
- âœ… **Sistema**: Configurar regras de negÃ³cio e validaÃ§Ãµes
- âœ… **Deploy**: Controlar atualizaÃ§Ãµes e manutenÃ§Ãµes

#### **âš™ï¸ Administradores (NÃ­vel 2)**

**PermissÃµes Administrativas:**

- âœ… **UsuÃ¡rios Comuns**: Gerenciar usuÃ¡rios nÃ£o-administrativos
- âœ… **RelatÃ³rios**: Gerar e visualizar relatÃ³rios administrativos
- âœ… **ConfiguraÃ§Ãµes BÃ¡sicas**: Modificar cargos e opÃ§Ãµes bÃ¡sicas
- âœ… **ModeraÃ§Ã£o**: Revisar e aprovar registros pendentes
- âŒ **Super FunÃ§Ãµes**: NÃ£o pode gerenciar outros admins ou super usuÃ¡rios

#### **ğŸ‘¤ UsuÃ¡rios Normais (NÃ­vel 1)**

**PermissÃµes BÃ¡sicas:**

- âœ… **Dashboard Pessoal**: Visualizar mÃ©tricas prÃ³prias
- âœ… **Registro**: Cadastrar presenÃ§as e informaÃ§Ãµes pessoais
- âœ… **RelatÃ³rios Pessoais**: Ver prÃ³prios dados e estatÃ­sticas
- âœ… **Perfil**: Editar informaÃ§Ãµes pessoais bÃ¡sicas
- âŒ **FunÃ§Ãµes Administrativas**: Sem acesso a painÃ©is administrativos

### **ğŸ›¡ï¸ ImplementaÃ§Ãµes de SeguranÃ§a**

```typescript
// VerificaÃ§Ã£o de autenticaÃ§Ã£o
const isAuthenticated = user && user.uid;

// VerificaÃ§Ã£o de nÃ­vel de acesso
const isSuperUser = user?.email && SUPER_USERS.includes(user.email);
const isAdmin = user?.role === "admin" || isSuperUser;

// Guards de proteÃ§Ã£o
<SuperUserGuard>
  <AdminPanel />
</SuperUserGuard>;
```

#### **Regras de Firestore (ProduÃ§Ã£o)**

```javascript
rules_version;
```
