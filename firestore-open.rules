rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // üîì REGRAS ABERTAS PARA USU√ÅRIOS CRIADOS DINAMICAMENTE
    // Use estas regras temporariamente at√© configurar o Firebase CLI
    
    // Fun√ß√£o para verificar se √© Super Usu√°rio
    function isSuperUser() {
      return request.auth != null && (
        request.auth.token.email == "admin@ipda.org.br" ||
        request.auth.token.email == "marciodesk@ipda.app.br"
      );
    }
    
    // Regras para cole√ß√£o de usu√°rios - ABERTA PARA USU√ÅRIOS AUTENTICADOS
    match /users/{userId} {
      // Super usu√°rios podem fazer tudo
      allow read, write: if isSuperUser();
      
      // QUALQUER usu√°rio autenticado pode ler e escrever SEU PR√ìPRIO documento
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Super usu√°rios podem criar novos usu√°rios
      allow create: if isSuperUser();
    }
    
    // Regras para cole√ß√£o de presen√ßa (attendance) - ABERTA PARA USU√ÅRIOS AUTENTICADOS
    match /attendance/{document} {
      // Qualquer usu√°rio autenticado pode ler e escrever presen√ßa
      allow read, write: if request.auth != null;
    }
    
    // Regras para configura√ß√µes do sistema
    match /system/{document} {
      // Qualquer usu√°rio autenticado pode ler, super podem escrever
      allow read: if request.auth != null;
      allow write: if isSuperUser();
    }
    
    // Regras para relat√≥rios (APENAS SUPER USU√ÅRIOS)
    match /reports/{document} {
      allow read, write: if isSuperUser();
    }
    
    // Regras para cole√ß√µes administrativas (APENAS SUPER USU√ÅRIOS)
    match /admin/{document} {
      allow read, write: if isSuperUser();
    }
    
    // Regras gerais para outras cole√ß√µes
    match /{document=**} {
      // Super usu√°rios t√™m acesso total
      allow read, write: if isSuperUser();
      
      // Qualquer usu√°rio autenticado tem acesso de leitura
      allow read: if request.auth != null;
    }
  }
}
